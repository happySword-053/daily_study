`Cache-Control` 字段是 HTTP 协议中用于控制缓存策略的重要通用首部字段，在 HTTP 请求和响应中都可以使用，它能够精细地控制缓存的行为，以此来平衡数据的新鲜度和性能优化之间的关系。以下详细介绍其作用、使用方式及示例。

### 作用

  

- **控制缓存的可存储性**：决定缓存（如浏览器缓存、代理服务器缓存）是否可以存储响应内容。
- **设置缓存的验证规则**：规定缓存何时需要向原始服务器验证资源的有效性。
- **设定缓存的时间限制**：指定缓存可以使用响应副本的有效时长。

### 常见指令及使用方式

#### 1. `public` 和 `private`

  

- **`public`**：表示响应可以被任何缓存（包括公共缓存和私有缓存）存储。
    - **示例（响应头）**：

  

收起

plaintext

```
Cache-Control: public
```

  

这意味着该响应可以被浏览器、代理服务器等各种缓存设备缓存。

  

- **`private`**：表示响应只能被私有缓存（如浏览器缓存）存储，公共缓存（如代理服务器缓存）不能存储。
    - **示例（响应头）**：

  

收起

plaintext

```
Cache-Control: private
```

  

常用于包含用户特定信息的响应，确保不同用户的数据不会被共享缓存。

#### 2. `no-cache` 和 `no-store`

  

- **`no-cache`**：缓存可以存储响应，但在使用缓存副本之前必须先向原始服务器验证资源的有效性（通过发送条件请求）。
    - **示例（请求头或响应头）**：

  

收起

plaintext

```
Cache-Control: no-cache
```

  

在请求头中使用时，客户端要求服务器验证缓存的有效性；在响应头中使用时，服务器要求缓存每次使用前都要进行验证。

  

- **`no-store`**：缓存不得存储请求或响应的任何部分，每次请求都必须直接从服务器获取最新资源。
    - **示例（请求头或响应头）**：

  

收起

plaintext

```
Cache-Control: no-store
```

  

适用于包含敏感信息的响应，确保数据不会被意外缓存。

#### 3. `max-age`

  

- **作用**：指定缓存可以使用响应副本的最长时间（以秒为单位），从响应生成的时间开始计算。
    - **示例（响应头）**：

  

收起

plaintext

```
Cache-Control: max-age=3600
```

  

表示该响应在 3600 秒（即 1 小时）内可以使用缓存副本，超过这个时间后，缓存需要重新向服务器请求资源。

#### 4. `s-maxage`

  

- **作用**：类似于 `max-age`，但仅适用于公共缓存（如代理服务器缓存）。当 `s-maxage` 和 `max-age` 同时存在时，公共缓存会优先使用 `s-maxage` 的值。
    - **示例（响应头）**：

  

收起

plaintext

```
Cache-Control: max-age=7200, s-maxage=3600
```

  

对于代理服务器缓存，该响应在 3600 秒内可以使用缓存副本；对于浏览器等私有缓存，在 7200 秒内可以使用缓存副本。

#### 5. `must-revalidate`

  

- **作用**：当缓存的响应过期后，缓存必须向原始服务器验证资源的有效性，不能使用过期的缓存副本。
    - **示例（响应头）**：

  

收起

plaintext

```
Cache-Control: max-age=3600, must-revalidate
```

  

表示在 3600 秒内可以使用缓存副本，超过这个时间后，缓存必须向服务器验证资源是否有更新。

### 综合示例

  

以下是一个服务器响应头中使用 `Cache-Control` 字段的综合示例：

  

收起

plaintext

```
Cache-Control: public, max-age=3600, must-revalidate
```

  

这个示例表明：

  

- 响应可以被任何缓存（包括公共缓存和私有缓存）存储。
- 缓存可以在 3600 秒（1 小时）内使用该响应的缓存副本。
- 当缓存副本过期后，必须向原始服务器验证资源的有效性，不能直接使用过期的缓存。

分享

用了这个字段，接收的实体就会被缓存到浏览器？下次请求的时候，浏览器又怎么知道是要向服务器请求还是直接查缓存？

### 缓存过程与浏览器决策机制

#### 1. 缓存过程

  

当服务器响应中包含 `Cache-Control` 字段时，浏览器会根据该字段的指令来决定是否缓存响应的实体内容。以下是不同指令下的缓存情况：

  

- **`public` 或 `private`**
    - 如果响应头中包含 `Cache-Control: public`，表示响应可以被任何缓存（包括公共缓存如代理服务器缓存和私有缓存如浏览器缓存）存储。
    - 如果是 `Cache-Control: private`，则响应只能被私有缓存（浏览器缓存）存储。例如，当服务器返回如下响应头：

  

收起

plaintext

```
Cache-Control: private
Content-Type: text/html
Content-Length: 1234
```

  

浏览器会将该响应的实体内容（HTML 页面）存储在自己的缓存中。

  

- **`max - age`**  
    当 `Cache-Control` 包含 `max - age` 指令时，浏览器会根据指定的时间（以秒为单位）来确定缓存的有效期。例如：

  

收起

plaintext

```
Cache-Control: max-age=3600
```

  

浏览器会记录下该响应的缓存时间为 3600 秒（1 小时），在这个时间段内，浏览器可以直接使用缓存的内容。

#### 2. 浏览器判断请求来源机制

  

浏览器在下次发起请求时，会依据 `Cache-Control` 字段以及其他相关信息来决定是向服务器请求资源还是直接使用缓存，具体决策过程如下：

  

- **检查 `max - age` 或 `s - maxage`**
    
    - 浏览器会首先检查响应的 `max - age`（对于私有缓存）或 `s - maxage`（对于公共缓存）。如果当前时间距离响应生成时间未超过指定的 `max - age` 或 `s - maxage`，且没有其他限制条件，浏览器会直接使用缓存的内容。
    - 例如，之前响应头为 `Cache-Control: max-age=3600`，当用户在 1 小时内再次请求相同资源时，浏览器会直接从缓存中获取该资源。
- **`no - cache` 情况**
    
    - 如果响应头包含 `Cache-Control: no-cache`，浏览器不会直接使用缓存内容，而是会向服务器发送一个条件请求，询问服务器该资源是否有更新。通常会使用 `ETag` 或 `Last - Modified` 字段来进行验证。
    - 例如，浏览器在请求时会带上类似如下的请求头：

  

收起

plaintext

```
If-None-Match: "abc123"  # 基于 ETag 的验证
If-Modified-Since: Tue, 20 Feb 2025 12:00:00 GMT  # 基于 Last - Modified 的验证
```

  

服务器会根据这些信息判断资源是否有更新，如果没有更新，服务器会返回 304 状态码（Not Modified），浏览器则使用缓存内容；如果有更新，服务器会返回新的资源。

  

- **`no - store` 情况**  
    当响应头包含 `Cache-Control: no-store` 时，浏览器不会对该响应进行缓存，每次请求都会直接向服务器获取最新资源。
    
- **`must - revalidate` 情况**  
    如果响应头包含 `Cache-Control: must-revalidate`，当缓存过期后，浏览器必须向服务器验证资源的有效性，不能使用过期的缓存副本。例如，之前响应头为 `Cache-Control: max-age=3600, must-revalidate`，当 1 小时过去后，浏览器再次请求该资源时，会向服务器发送条件请求进行验证。