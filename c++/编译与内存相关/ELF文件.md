ELF（Executable and Linkable Format）是一种用于可执行文件、目标文件、共享库和核心转储文件的标准文件格式，在 Linux 和其他类 Unix 系统中广泛使用。通过 `g++` 编译生成的 C++ 可执行文件通常就是 ELF 格式。下面详细介绍 ELF 文件的构成。

### 总体结构

  

ELF 文件主要由三部分组成：ELF 头（ELF Header）、程序头表（Program Header Table）和节头表（Section Header Table），此外还包含各种节（Section）和段（Segment）。不同类型的 ELF 文件（如可执行文件、目标文件、共享库）在具体结构和内容上会有一些差异，但总体框架是相似的。

### 各部分详细介绍

#### 1. ELF 头（ELF Header）

  

- **位置**：位于 ELF 文件的起始部分，固定大小。
- **作用**：包含了整个 ELF 文件的总体信息，如文件类型（可执行文件、目标文件、共享库等）、目标机器架构、入口点地址（对于可执行文件）、程序头表和节头表的位置和大小等。这些信息帮助操作系统和链接器正确解析和处理 ELF 文件。
- **示例查看**：可以使用 `readelf -h` 命令查看 ELF 文件的 ELF 头信息，例如 `readelf -h your_program`。

#### 2. 程序头表（Program Header Table）

  

- **位置**：紧跟在 ELF 头之后（对于可执行文件和共享库）。
- **作用**：描述了如何将文件内容映射到内存中，定义了程序的各个段（Segment）。段是逻辑上的概念，用于组织和管理程序在内存中的布局，例如代码段、数据段、堆栈段等。程序头表中的每个条目对应一个段，包含段的类型、偏移量、虚拟地址、物理地址、大小等信息。
- **示例查看**：使用 `readelf -l` 命令可以查看 ELF 文件的程序头表信息，例如 `readelf -l your_program`。

#### 3. 节头表（Section Header Table）

  

- **位置**：通常位于文件末尾。
- **作用**：描述了文件中各个节（Section）的信息。节是 ELF 文件中最基本的组织单位，用于存储不同类型的数据，如代码、数据、符号表、重定位信息等。节头表中的每个条目对应一个节，包含节的名称、类型、偏移量、大小、地址对齐等信息。
- **示例查看**：使用 `readelf -S` 命令可以查看 ELF 文件的节头表信息，例如 `readelf -S your_program`。

#### 4. 节（Section）

  

- **定义**：是 ELF 文件中实际存储数据的区域，每个节都有特定的用途。
- **常见节类型**：
    - **.text**：存储程序的机器代码，即程序的可执行指令。
    - **.data**：存储已初始化的全局变量和静态变量。
    - **.bss**：存储未初始化的全局变量和静态变量，在程序加载时会被初始化为 0。
    - **.rodata**：存储只读数据，如常量字符串。
    - **.symtab**：符号表，包含了程序中定义和引用的符号（如函数名、变量名）的信息。
    - **.rel.text** 和 **.rel.data**：重定位表，用于在链接和加载时调整符号的地址。

#### 5. 段（Segment）

  

- **定义**：是程序在内存中的逻辑划分，由一个或多个节组成。
- **常见段类型**：
    - **LOAD**：可加载段，包含了程序的代码和数据，会被加载到内存中执行。
    - **DYNAMIC**：动态链接段，包含了动态链接器所需的信息，用于处理共享库的加载和符号解析。
    - **NOTE**：注释段，用于存储一些额外的信息，如版权声明、调试信息等。

### 不同类型 ELF 文件的差异

  

- **目标文件**：通常包含所有的节，但没有程序头表，因为目标文件还没有经过链接，不需要指定内存布局。
- **可执行文件**：包含 ELF 头、程序头表、节头表和各种节，程序头表用于指定如何将文件内容加载到内存中。
- **共享库**：类似于可执行文件，但没有明确的入口点，并且需要在运行时动态链接到其他程序中。

  
![[Pasted image 20250219172222.png]]。