# 持久化技术
- rdb 简单来说就是快照
- aof 记录操作数据库的所有指令
![[Pasted image 20241005144725.png]]

redis默认使用rdb
# rdb
RDB持久性以指定的时间间隔执行数据集的时间点快照，把某一刻的数据和状态以文件的形式写到磁盘上，恢复时再将快照文件直接读回到内存里 （dump.rdb） 
在redis.conf文件里找到snap可以查看相关信息
![[Pasted image 20241005151005.png]]


![[Pasted image 20241005151633.png]] 
# 自动触发
redis会有指定的时间轮询，当进入了一个新的时间轮询后，如果达到指定次数，那么将会自动触发RDB
比如说5秒修改的频率达到3次就会触发RDB。
假设你在第一个 5 秒内只进行了两次修改，并且在接下来的 5 秒（第二个 5 秒）内没有进行任何修改，那么这并不会触发 RDB 快照。原因如下：

- 在第一个 5 秒时间段内，只有两次修改，没有达到触发条件。
- 在第二个 5 秒时间段内，没有新的修改发生，所以累计修改次数仍然是两次，依然没有达到触发条件。
- 如果在第三个5秒发生了修改，那么达到条件，将会自动触发save  


# 手动触发
手动触发RDB有两种命令，一个是save一个是bgsave(默认)。
**注意！**： 实际开发中不可使用save！，因为调用了save命令后会阻塞当前主进程，导致redis无法进行吞吐 。
bgsave不会导致阻塞，调用bgsave后，redistribution会在后台异步进行快照操作

直接在redis的命令行里调用BGSAVE即可

![[Pasted image 20241005162823.png]]
 bgsave会让redis在后台异步进行快照操作，不阻塞
 可以使用*lastsave*命令来查看最后一次保存的时间
![[Pasted image 20241008165751.png]]
