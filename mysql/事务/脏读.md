### **脏读（Dirty Read）**

**脏读**是指在一个事务中读取了另一个事务尚未提交的数据，随后如果该数据被回滚，则前一个事务所读到的数据就变成了“脏”的数据。脏读会导致数据不一致问题，尤其在需要保证高一致性的系统中，这是一个严重的问题。

---

### **脏读的触发条件**

1. **并发事务**：必须存在至少两个并发事务。
2. **隔离级别较低**：事务隔离级别是 **READ UNCOMMITTED**（读未提交）。
3. **未提交的数据被读取**：一个事务读取了另一个事务未提交的修改。

---

### **示例**

#### 假设有如下数据表：

sql

复制代码

`CREATE TABLE accounts (     id INT PRIMARY KEY,     balance DECIMAL(10,2) );  INSERT INTO accounts (id, balance) VALUES (1, 1000.00), (2, 1500.00);`

#### 场景：

- **事务 A** 修改 `id=1` 的账户余额，将其从 1000.00 改为 800.00，但尚未提交。
- **事务 B** 读取 `id=1` 的账户余额，看到的是 800.00。
- 之后 **事务 A** 回滚更改，`id=1` 的余额恢复到 1000.00。
- **事务 B** 此时所读取的 800.00 是一个“脏数据”。

#### SQL 操作：

**事务 A：**

sql

复制代码

`START TRANSACTION; UPDATE accounts SET balance = 800.00 WHERE id = 1; -- 尚未提交`

**事务 B：**

sql

复制代码

`SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;  -- 设置为最低隔离级别 START TRANSACTION; SELECT balance FROM accounts WHERE id = 1; -- 结果：800.00（读取了事务 A 未提交的数据）`

**事务 A 回滚：**

sql

复制代码

`ROLLBACK;`

**事务 B 的数据问题：**

- 事务 B 读取到了 800.00，但最终数据实际还是 1000.00。
- 事务 B 所做的后续决策可能基于错误数据。

---

### **脏读的影响**

1. **数据不一致：**  
    事务之间互相读取未提交的数据，可能导致最终的数据状态不准确。
    
2. **业务逻辑错误：**  
    由于读取了脏数据，可能导致依赖数据的业务逻辑产生错误决策。例如：银行转账中，读取了未提交的账户余额，会引发错误的交易操作。
    
3. **难以调试：**  
    并发问题通常较难复现，脏读问题往往使得调试更加复杂。
    

---

### **避免脏读的方法**

1. **提高隔离级别：**  
    使用至少 **READ COMMITTED** 隔离级别（或更高的隔离级别），避免读取未提交数据。
    
    sql
    
    复制代码
    
    `SET TRANSACTION ISOLATION LEVEL READ COMMITTED;`
    
2. **使用锁机制：**  
    对被修改的数据加锁，确保未提交的数据不会被其他事务读取。InnoDB 引擎在更高隔离级别下自动实现此功能。
    
3. **遵循事务提交规范：**  
    在系统设计时，确保事务尽快提交或回滚，避免长时间持有未提交的数据。
    

---

### **隔离级别对比脏读问题**

| 隔离级别                 | 脏读  | 不可重复读 | 幻读  |
| -------------------- | --- | ----- | --- |
| **READ UNCOMMITTED** | ✅   | ✅     | ✅   |
| **READ COMMITTED**   | ❌   | ✅     | ✅   |
| **REPEATABLE READ**  | ❌   | ❌     | ✅   |
| **SERIALIZABLE**     | ❌   | ❌     | ❌   |

在实际开发中，默认的 **REPEATABLE READ** 隔离级别可以避免脏读问题。

---

### **结论**

- **脏读** 是低隔离级别（READ UNCOMMITTED）中的一种并发问题，主要表现为读取未提交的数据。
- 在高一致性要求的场景（如金融系统）中，应避免使用可能导致脏读的隔离级别，或者通过设计确保事务提交的快速性和数据的一致性。