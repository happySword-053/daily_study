问： 说说 MySQL 主从同步的原理
MySQL 主从同步是 MySQL 数据库两台服务器之间实现数据同步的一种技术。它可以将主服务器(Master)上的变动数据（如新插入、更新、删除等）同步到从服务器(Slave)上，从而确保两个服务器上的数据保持同步。MySQL 主从同步主要有两种原理：基于行的复制和基于语句的复制。

基于行的复制是将主服务器上的每一行数据以二进制形式复制到从服务器上，从而实现数据的完全同步。这种方式可以保证数据的完全一致，但是同步速度比较慢，也容易受到网络延迟的影响。

基于语句的复制是将主服务器上的 SQL 语句复制到从服务器上，从而实现数据的同步。这种方式的优点是同步速度快，但是数据同步精度降低，容易出现延迟数据的情况。
详细见前面的章节

问： 有哪些方案可以保证 MySQL 的高可用
主从复制+读写分离
MySQL 主从复制技术是用于在 MySQL 数据库中实现数据同步的一种技术。主要分为两种：单主复制，多主复制。
单主复制是最常用的 MySQL 主从复制技术，它包含一个主库(Master)和一个或多个备库(Slave)。主库执行数据写入操作，而备库则从主库获取数据并进行复制，这种技术可以为数据提供冗余备份，防止数据丢失。
多主复制架构包含多个主库和一个或多个备库。每个主服务器都可以写入数据，而备库则从主服务器中获取数据并进行复制。同单主复制相比多主复制技可以提高性能，同时可以减少数据延迟。
传统的 MySQL 的复制技术仅解决了数据同步的问题，但不支持故障转移（Failover）功能。主库宕机时，数据库管理员需要人工介入，手工主从切换，应用系统可能需要修改数据库连接地址或者重启才能恢复服务。MySQL 组复制(MySQL Group Replication,简称 MGR）是 MySQL 官方于 2016 年 12 月推出了一个全新的高可用与高扩展的解决方案。它在数据库层面上做到失效自动转移功能，只要集群中大多数主机可用，则服务可用，组复制技术比单主复制和多主复制都更加可靠，可以有效提高 MySQL 的性能，提供更高的可用性。
优点：成本低、架构简单、易实施、维护方便
缺点：master 出现问题后不能自动到 slave 上，需要人工干涉。

MySQL Cluster
MySQL InnoDB Cluster 是 MySQL 官方提供的高可用性和自动故障转移的集群解决方案。它基于 MySQL InnoDB 存储引擎和组复制技术(Group Replication)实现的，支持多个 MySQL 数据库实例进行数据同步复制，也支持故障转移（Failover）。
优点：安全性高，稳定性高。可以在线增加节点
缺点：架构复杂，至少三个节点，对于引擎只能用 ndb，不支持外键，管理复杂，部署费时而且是收费的。

问： MySQL 集群的优缺点
MySQL 集群的优点主要有高可用性和灵活的分布式体系结构，没有单点故障，高吞吐量和低延迟，可扩展性强，支持在线扩容。
MySQL 集群缺点主要有：存在很多限制，比如：不支持外键、部署、管理、配置很复杂、占用磁盘空间大、内存大、备份和恢复不方便、重启的时候，数据节点将数据 load 到内存需要很长的时间。

问： 你是如何监控你能数据库的
一、MySQL 数据库监控的重要性
MysQL 数据库监控对于维护系统可用性和性能至关重要,因为它可以让 DBA 及时发现和解决性能问题,从而避免系统发生故障或性能下降。
此外,MySQL 数据库监控还可以帮助 DBA 发现任何潜在的安全问题,并防止数据库被黑客攻击。
最后,MySQL 数据库监控可以帮助 DBA 跟踪数据库的使用情况,以便更好地理解数据库的状态,并进行后续优化。

二、MySQL 数据库监控的基本原则
MySQL 数据库监控的基本原则包括:
1.预防为主:监控 MySQL 数据库的重中之重是要提前发现问题,尽早采取措施防止数据库出现大问题,比如说定期执行一些基本的检查,及时处理数据库账号信息,检查数据库应用程序和数据库版本的兼容性,定期备份数据库和日志文件等等。

2.运维人员要精通数据库系统的原理、架构:要想对 MySQL 数据库进行有效的监控,就需要对 MySQL
数据库的原理、架构有一定的了解,这样才能更好地把握监控的方向,及时发现问题,提高 MySQL 数据库的可用性和安全性。

3.做好应急预案:MySQL 数据库的监控也要考虑到紧急情况的出现,因此,DBA 需要做好应急预案,在紧急情况下如何迅速处理,以减少损失。

三、MySQL 数据库监控的步骤

1.设置 MySQL 监控策略:首先,你需要分析你的数据库的具体要求,以确定需要监控的参数;
2.配置 MySQL 实时监控工具:一般来说,MySQL 监控系统可以使用标准的 MySQL 客户端工具来连接数据库,也可以使用第三方的监控工具来实现 1:
3.监控 MySQL 数据库:监控 MySQL 数据库的主要内容有:数据库服务器运行状况、数据库连接数量、数据库备份、数据库查询性能;
4.分析和报告 MySQL 数据库监控结果:监控 MySQL 数据库后,需要根据监控的结果,对数据库进行分析,并对数据库运行状况进行报告;
5.优化 MySQL 数据库:根据分析结果,可以进行相应的 MysQL 数据库优化,提高数据库的性能和可靠性。

通过 Prometheus 采集 mysql exporter 与 node exporter ,通过 Grafana 作为展示



问：如何加强 MySQL 安全，请给出可行的具体措施
账号安全：
移除匿名账户和废弃的账户，禁止 MySQL 以管理员账号权限运行，限制 mysql 数据库用户的权限
避免直接从互联网访问 mysql 数据库，确保特定主机才拥有访问权限。禁用或限制远程访问可以在 my.cnf 文件里设置 bind-address 指定 ip
定期备份数据库。
移除 test 数据库（默认匿名用户可以访问 test 数据库）。
确保系统安装了最新的安全补丁。注意：在保证业务及网络安全的前提下，并经过兼容性测试后，安装更新补丁。
开启日志审计功能：数据库应配置日志功能，便于记录运行状况和操作行为。
问： 如果发现 CPU，或者 IO 压力很大，怎么定位问题
从机器找原因：1、首先我会用 top 命令和 iostat 命令，定位是什么进程在占用 cpu 和磁盘 io；
从 MySQL 找原因：
1、如果是 mysql 的问题，我会登录到数据库，通过 show full processlist 命令，看现在数据库在执行什么 sql 语句，是否有语句长时间执行使数据库卡住；
2、执行 show engine innodb status\G 命令，查看数据库是否有锁资源争用；
3、查看 mysql 慢查询日志，看是否有慢 sql；
4、找到引起数据库占用资源高的语句，进行优化，该建索引的建索引，索引不合适的删索引，或者根据情况 kill 掉耗费资源的 sql 语句等。

