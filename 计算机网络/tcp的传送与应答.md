### **超时重传与零窗口探测的区别**

#### （1）**超时重传（Retransmission Timeout, RTO）**

- **触发条件** ：发送方在 `RTO` 时间内未收到接收方对已发送数据的确认（ACK）。
- **行为** ：重传未被确认的数据段（例如丢失的数据包）。
- **目的** ：确保数据的可靠性，应对网络丢包或延迟。

#### （2）**零窗口探测报文（Zero Window Probe）**

- **触发条件** ：接收方通告窗口大小为 0（即接收方缓冲区已满），且发送方在持续计时器（Persist Timer）超时后仍未收到新的窗口更新。
- **行为** ：发送一个 **1 字节的探测报文** （携带 1 字节数据），强制接收方回复当前窗口大小。
- **目的** ：避免因接收方窗口长期为 0 导致死锁，确保发送方能够及时发现窗口更新。

### **累积确认（Cumulative ACK）**

TCP 的确认机制是**累积的** ，即接收方只需要确认**已连续接收的最后一个字节序号** ，而不需要对每个段单独发送 ACK。例如：

- 发送方连续发送了三个段：`[1-100]`、`[101-200]`、`[201-300]`。
- 如果接收方成功接收这三个段，它会直接回复一个 `ACK 301`，表示期望接收下一个字节序号为 301 的数据。
- 发送方收到 `ACK 301` 后，知道 `[1-300]` 的数据已被全部确认，无需逐个确认每个段。


### **发送方的批量发送**

TCP 发送方会根据**滑动窗口大小** 和**拥塞控制策略** ，一次性发送多个段，而不需要等待每个段的 ACK。例如：

- 如果窗口大小为 1000 字节，且每个段大小为 200 字节，发送方可以连续发送 5 个段（`[1-200]`、`[201-400]`、`[401-600]`、`[601-800]`、`[801-1000]`），然后等待接收方的 ACK。
- 接收方可能回复 `ACK 1001`，确认所有已接收的数据。
### **TCP 的异步性体现在哪里？**

#### 1. **非阻塞的批量发送**

- 发送方会**持续发送窗口内允许发送的所有数据段** ，而不会因为等待某个数据段的 ACK 而阻塞后续数据的发送。
- 例如，如果窗口大小为 10 KB，发送方可以一次性将 10 KB 的数据全部发送出去，无需逐个等待 ACK。

#### 2. **事件驱动的 ACK 处理**

- 发送方和接收方通过独立的事件处理机制管理数据传输：
    - **发送方** ：持续发送数据段，直到填满窗口。
    - **接收方** ：异步接收数据段，并在适当的时候发送累积 ACK。
- ACK 的发送和处理是异步的，不会阻塞数据的发送或接收。

#### 3. **发送缓冲区与接收缓冲区**

- **发送缓冲区** ：应用程序写入的数据会被暂存到发送缓冲区，TCP 协议栈异步地从缓冲区中取出数据并发送。
- **接收缓冲区** ：接收方将接收到的数据暂存到接收缓冲区，应用程序异步地从缓冲区中读取数据。

---

### **异步发送与窗口滑动的协同**

TCP 的异步发送依赖于**滑动窗口机制** ，具体流程如下：

1. **初始阶段** ：发送方根据接收方通告的窗口大小，一次性发送多个数据段（填满窗口）。
2. **ACK 到达** ：当接收方返回 ACK 时，发送方的窗口向前滑动，释放已确认的数据段占用的窗口空间。
3. **持续发送** ：只要窗口内有可用空间，发送方会立即填充新的数据段，无需等待前一个批次的 ACK。


### **发送窗口的实际大小**

发送方的**实际可用窗口** 是 **`min(cwnd, rwnd)`** ，即：

- **发送方最多能发送的数据量** = `min(拥塞窗口, 接收窗口)`。
- **谁更小，谁决定发送速率** ：
    - 如果网络拥塞严重（`cwnd` 小），发送速率受拥塞窗口限制。
    - 如果接收方处理能力不足（`rwnd` 小），发送速率受接收窗口限制。