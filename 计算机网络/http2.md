HTTP/2引入了头部压缩，使用HPACK算法，其中确实用到了静态和动态表来存储头部字段，这样在传输时可以用索引代替重复的字段名，减少数据量。尤其是常用字段如method、path等在静态表里有预定义的索引。

在 HTTP/2 的 HPACK 编码中：

1. **静态表索引** 直接包含字段名和值（如 `:status: 200`），但**仅当字段名和值完全匹配静态表条目时** 才能直接用索引。
2. 如果字段名在静态表中存在，但值不匹配，则需要**分段编码** ：先用索引表示字段名，再以字面量表示值。



**HTTP/2 的核心特性之一就是多路复用（Multiplexing）** ，这是其与 HTTP/1.x 最显著的区别之一。通过多路复用，HTTP/2 彻底解决了 HTTP/1.x 中的**队头阻塞（Head-of-Line Blocking）**问题，并显著提升了传输效率。


### **HTTP/2 多路复用的核心机制**

1. **二进制分帧（Binary Framing）**
    
    - 所有数据被拆分为 **二进制帧（Frame）** ，每个帧属于一个特定的 **流（Stream）** 。
    - 帧可以交错传输（Interleaved），接收端根据流 ID 重组数据。
2. **流（Stream）**
    
    - 每个请求/响应对分配一个独立的流（通过唯一的 **Stream ID** 标识）。
    - 多个流在同一个 TCP 连接上并行传输，无需排队。
3. **并行传输与优先级**
    
    - 不同流的帧可以混合发送，接收端按流 ID 重组。
    - 支持为流设置优先级（如优先传输 CSS/JS 而非图片）。 
#### HTTP/2 的二进制分帧革命




```plaintext
+-----------------------------------------------+
| Length (24 bits)                              | → 帧长度
+---------------+---------------+---------------+
| Type (8 bits) | Flags (8 bits)                | → 帧类型/标志位
+-------------------------------+---------------+
| R (1 bit)     | Stream ID (31 bits)           | → 流标识符
+---------------+---------------+---------------+
|                 帧载荷 (可变长度)                | → 真实数据
+-----------------------------------------------+
```

HTTP/2 定义了 **10种核心帧类型**（实际只需4位！），其余为保留位：

|类型值（十进制）|帧类型|使用场景|
|---|---|---|
|0x0 (0)|**DATA**|传输正文数据|
|0x1 (1)|**HEADERS**|打开流或携带HTTP头|
|0x2 (2)|**PRIORITY**|调整流优先级|
|0x3 (3)|**RST_STREAM**|立即终止流|
|0x4 (4)|**SETTINGS**|连接级参数协商|
|0x5 (5)|**PUSH_PROMISE**|服务端推送资源承诺|
|0x6 (6)|**PING**|测活与延迟检测|
|0x7 (7)|**GOAWAY**|优雅终止连接|
|0x8 (8)|**WINDOW_UPDATE**|流量控制窗口更新|
|0x9 (9)|**CONTINUATION**|延续HEADERS帧|
#### 2. 核心标志位（以HEADERS帧为例）

| 比特位   | 标志名             | 功能                     |
| ----- | --------------- | ---------------------- |
| Bit 0 | **END_STREAM**  | 当前流结束（如请求无Body）        |
| Bit 2 | **END_HEADERS** | 头块结束（不再有CONTINUATION帧） |
| Bit 3 | **PADDED**      | 载荷含填充长度字段（防流量分析）       |
| Bit 5 | **PRIORITY**    | 包含优先级权重（依赖树调度）         |